package me.bunny.kernel._c.support.treeview;

import java.util.ArrayList;
import java.util.Iterator;
import java.util.List;

import me.bunny.kernel._c.json.JJSON;
import me.bunny.kernel._c.support.JView;

/**
 * [
  {
    "id": "3ed14532265b41f59244d2ad580c0108", 
    "name": "3ed14532265b41f59244d2ad580c0108", 
    "meta": {
      "level": 1, 
      "path": [
        "3ed14532265b41f59244d2ad580c0108"
      ], 
      "absolutePath": "/3ed14532265b41f59244d2ad580c0108", 
      "offset": 1, 
      "globalOffset": "1"
    }, 
    "children": [
      {
        "id": "5813152971aa4437a6a95ba6e1d8a711", 
        "name": "5813152971aa4437a6a95ba6e1d8a711", 
        "meta": {
          "level": 2, 
          "path": [
            "3ed14532265b41f59244d2ad580c0108", 
            "5813152971aa4437a6a95ba6e1d8a711"
          ], 
          "absolutePath": "/3ed14532265b41f59244d2ad580c0108/5813152971aa4437a6a95ba6e1d8a711", 
          "offset": 1, 
          "globalOffset": "1.1"
        }, 
        "children": [
          {
            "id": "82d4c4f6cb63403fa7a82dc4c99c2545", 
            "name": "82d4c4f6cb63403fa7a82dc4c99c2545", 
            "meta": {
              "level": 3, 
              "path": [
                "3ed14532265b41f59244d2ad580c0108", 
                "5813152971aa4437a6a95ba6e1d8a711", 
                "82d4c4f6cb63403fa7a82dc4c99c2545"
              ], 
              "absolutePath": "/3ed14532265b41f59244d2ad580c0108/5813152971aa4437a6a95ba6e1d8a711/82d4c4f6cb63403fa7a82dc4c99c2545", 
              "offset": 1, 
              "globalOffset": "1.1.1"
            }, 
            "children": [ ]
          }
        ]
      }, 
      {
        "id": "312304c2872c4db49af283fdd4e29e7d", 
        "name": "312304c2872c4db49af283fdd4e29e7d", 
        "meta": {
          "level": 2, 
          "path": [
            "3ed14532265b41f59244d2ad580c0108", 
            "312304c2872c4db49af283fdd4e29e7d"
          ], 
          "absolutePath": "/3ed14532265b41f59244d2ad580c0108/312304c2872c4db49af283fdd4e29e7d", 
          "offset": 2, 
          "globalOffset": "1.2"
        }, 
        "children": [ ]
      }
    ]
  }, 
  {
    "id": "9607fa9e429747d091f8e2f09d300fff", 
    "name": "9607fa9e429747d091f8e2f09d300fff", 
    "meta": {
      "level": 1, 
      "path": [
        "9607fa9e429747d091f8e2f09d300fff"
      ], 
      "absolutePath": "/9607fa9e429747d091f8e2f09d300fff", 
      "offset": 2, 
      "globalOffset": "2"
    }, 
    "children": [
      {
        "id": "a891189d2196478d815ffe180fb62712", 
        "name": "a891189d2196478d815ffe180fb62712", 
        "meta": {
          "level": 2, 
          "path": [
            "9607fa9e429747d091f8e2f09d300fff", 
            "a891189d2196478d815ffe180fb62712"
          ], 
          "absolutePath": "/9607fa9e429747d091f8e2f09d300fff/a891189d2196478d815ffe180fb62712", 
          "offset": 1, 
          "globalOffset": "2.1"
        }, 
        "children": [ ]
      }, 
      {
        "id": "fde3f04002f84e808e2342d956b77040", 
        "name": "fde3f04002f84e808e2342d956b77040", 
        "meta": {
          "level": 2, 
          "path": [
            "9607fa9e429747d091f8e2f09d300fff", 
            "fde3f04002f84e808e2342d956b77040"
          ], 
          "absolutePath": "/9607fa9e429747d091f8e2f09d300fff/fde3f04002f84e808e2342d956b77040", 
          "offset": 2, 
          "globalOffset": "2.2"
        }, 
        "children": [ ]
      }
    ]
  }, 
  {
    "id": "7468d08e999846bf957f8ea6150351ba", 
    "name": "7468d08e999846bf957f8ea6150351ba", 
    "meta": {
      "level": 1, 
      "path": [
        "7468d08e999846bf957f8ea6150351ba"
      ], 
      "absolutePath": "/7468d08e999846bf957f8ea6150351ba", 
      "offset": 3, 
      "globalOffset": "3"
    }, 
    "children": [
      {
        "id": "52bb6871bcb149518dd1ccf329fed60d", 
        "name": "52bb6871bcb149518dd1ccf329fed60d", 
        "meta": {
          "level": 2, 
          "path": [
            "7468d08e999846bf957f8ea6150351ba", 
            "52bb6871bcb149518dd1ccf329fed60d"
          ], 
          "absolutePath": "/7468d08e999846bf957f8ea6150351ba/52bb6871bcb149518dd1ccf329fed60d", 
          "offset": 1, 
          "globalOffset": "3.1"
        }, 
        "children": [ ]
      }
    ]
  }, 
  {
    "id": "955c3d7c58734e839f114b66a186c66b", 
    "name": "955c3d7c58734e839f114b66a186c66b", 
    "meta": {
      "level": 1, 
      "path": [
        "955c3d7c58734e839f114b66a186c66b"
      ], 
      "absolutePath": "/955c3d7c58734e839f114b66a186c66b", 
      "offset": 4, 
      "globalOffset": "4"
    }, 
    "children": [ ]
  }, 
  {
    "id": "846b5ce4b28e43679425fe85f75d2d8b", 
    "name": "846b5ce4b28e43679425fe85f75d2d8b", 
    "meta": {
      "level": 1, 
      "path": [
        "846b5ce4b28e43679425fe85f75d2d8b"
      ], 
      "absolutePath": "/846b5ce4b28e43679425fe85f75d2d8b", 
      "offset": 5, 
      "globalOffset": "5"
    }, 
    "children": [ ]
  }
]
 * @author JIAZJ
 *
 */
public class JHierarchyTreeView implements
		JView {

	private final JTree tree;
	
	public JHierarchyTreeView(JTree tree){
		this.tree=tree;
	}
	
	private void processTreeNode(JTreeNode treeNode,JNodeTreeView parent){
		
		if(JTreeElement.class.isInstance(treeNode)){
			JTreeElement treeElement=(JTreeElement) treeNode;
			List<JTreeNode> treeNodes=treeElement.getChildren();
			for(int i=0;i<treeNodes.size();i++){
				JNodeTreeView thisNV= new JNodeTreeView();
				parent.getChildren().add(thisNV);
				processTreeNode(treeNodes.get(i), thisNV);
			}
		}
		JSimpleTreeStrcture treeStrcture= treeNode.getData();
		parent.setId(treeStrcture.getId());
		parent.setName(treeStrcture.getName());
		parent.setMeta(treeNode.getNodeMeta());
		parent.setData(treeStrcture.toMap());
	}
	
	public List<JNodeTreeView> models(){
		List<JNodeTreeView> nodeTreeViews=new ArrayList<JNodeTreeView>();
		for (Iterator<JTreeNode> iterator = tree.getTreeNodes().iterator(); iterator.hasNext();) {
			JTreeNode treeNode =  iterator.next();
			JNodeTreeView nodeTreeView=new JNodeTreeView();
			processTreeNode(treeNode, nodeTreeView);
			nodeTreeViews.add(nodeTreeView);
		}
		return nodeTreeViews;
	}
	
	@Override
	public String view() {
		List<JNodeTreeView> nodeTreeViews=models();
		return JJSON.get().formatObject(nodeTreeViews);
	}

}
