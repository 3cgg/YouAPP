<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"> 
<mapper namespace="com.youappcorp.project.usermanager.mapper.UserExtendMapper">


<resultMap id="jBaseModel"  type="j.jave.kernal.jave.model.JBaseModel"   >
<result column="ID" property="id"  jdbcType="VARCHAR" />
<result column="CREATEID" property="createId"  jdbcType="VARCHAR" />
<result column="UPDATEID" property="updateId"  jdbcType="VARCHAR" />
<result column="CREATETIME" property="createTime"  jdbcType="TIMESTAMP" />
<result column="UPDATETIME" property="updateTime"  jdbcType="TIMESTAMP" />
<result column="DELETED" property="deleted"  jdbcType="VARCHAR" />
<result column="VERSION" property="version"  jdbcType="INTEGER" />
</resultMap>

<resultMap id="userExtend"  type="com.youappcorp.project.usermanager.model.UserExtend"  extends="jBaseModel" >
<result column="USERID" property="userId"  jdbcType="VARCHAR" />
<result column="USERNAME" property="userName"  jdbcType="VARCHAR" />
<result column="USERIMAGE" property="userImage"  jdbcType="VARCHAR" />
<result column="NATURENAME" property="natureName"  jdbcType="VARCHAR" />
</resultMap>


<insert  id="saveModel" parameterType="com.youappcorp.project.usermanager.model.UserExtend">
insert into USERS_EXTEND
(
USERID,USERNAME,USERIMAGE,NATURENAME
,ID,CREATEID,UPDATEID,CREATETIME,UPDATETIME,DELETED,VERSION
)values(
#{userId},#{userName},#{userImage},#{natureName}
,#{id},#{createId},#{updateId},#{createTime},#{updateTime},#{deleted},#{version}
)
</insert>


<update id="updateModel">
update USERS_EXTEND
<set>  
UPDATEID =#{updateId},UPDATETIME =#{updateTime}
<if test="userId!=null">,USERID =#{userId}</if>
<if test="userName!=null">,USERNAME =#{userName}</if>
<if test="userImage!=null">,USERIMAGE =#{userImage}</if>
<if test="natureName!=null">,NATURENAME =#{natureName}</if>
<if test="version!=null">,VERSION =#{version}</if>
</set>  
where ID=#{id}
</update>


<delete id="markModelDeleted" >
update USERS_EXTEND set DELETED='Y' where ID=#{id}
</delete>


<select id="getModel"   resultMap="userExtend"  >
<include refid="selectfor"></include> 
where a.id=#{param1}
</select>


<sql id="selectfor">
select a.* 
from USERS_EXTEND a
left join USERS b on b.ID=a.USERID
</sql>
<sql id="associationFilter">
    (b.DELETED='N') 
</sql>


<select id="getModelsByPage"   resultMap="userExtend"  parameterType="j.jave.kernal.jave.model.JPageable">
select * from USERS_EXTEND  
<if test="page.sortColumn!=null ">
order by ${page.sortColumn} ${page.sortType}   
</if>
</select>

<select id="getUserExtendByUserId"  resultMap="userExtend" >
	<include refid="selectfor"/>
	where a.DELETED='N'
	and <include refid="associationFilter"/>
	and a.USERID=#{userId}
</select>

<select id="getUserExtendByNatureName"  resultMap="userExtend"  >
	<include refid="selectfor"/>
	where a.DELETED='N'
	and <include refid="associationFilter"/>
	and a.NATURENAME=#{natureName}
</select>


</mapper>